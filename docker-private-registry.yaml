---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort
---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVTlVxUGdLR2NVOGRVbVpkOHlhaXM3c241QVB3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd09EQXpNVGN4TXpBd1doY05NakV3T0RBek1UY3gKTXpBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUN6TmM2c3dxSE9BV1F6dUNzSk9RLy9hcXJZY09WdURPa0FoSXhhSDlzKzVTS1Z1MW43SFFpdApLWTZzVWkySjVFTGJkWXhFYmtBMEVvVmN4RHpmL2d0M0FQY2NXT1FLaDZmMW9NaHRtL2FEbjBOWXpab04yODEvCkdjYURnTkxWZ1FhM0xpZVRJMnJFMzkyd1B0RVBQcHJ2d0lvTkZFUzdFckd0Nnp0RU5BLzZ5dExOblNEdzYvM0kKeDQxWHJkSHpyT1VNN3V1QXl2OTlSR2FneTVWbS9ZOHhtM3JiTktwSFZsNTRjamdNeE1qcWVFcDBTazNqcmNwRQp5SERxcGpkdVpaZmR5b2FRdGhkVDhJeW9BYlBQWDNubG9qS1MzaXg0aVF4anRJR0hZcW9FekxJblpyb2x6ZlVZClBrSVRNREZrWm1pS1FUV05PNmR1ckpDMDJhc0Z0YndWQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlQxcVBuTTVpRVFiZEJmVGd6RzdsZU9kTE9yWHpBZkJnTlZIU01FR0RBV2dCUy9KRUlrCmhNeVA1L0N5SE01eXlGU2ZldmNlWXpBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBSUJVNzBhclpSRTV0ek1EYmRKK1ZsaWxLazExQ2V5dFpRMXE1dXZ4RzIrQgpZVU9CZER5Qjh3ZEQ4Vk9Qc0RzMDlubUU2bkd2bnpkQk9GK0NFeFpUZnlkS3lTUm5DK1FrZ2lUSEFNMmRxdjk0CmhiZ3J4UW9uN1hNcFo0WU1rcVlLbmdwN2NoVzhjZFdkcVpMaUpDeVRJL0E0Q29VNUR6eHN5K2VqV2wzUGxwQXYKeGpsYTBRd25od2RKL3g3NnBtdTluVkU3RzhJTGJWVlh1NGhqdDhxcUdLT25xaWtsZ0EvVENuNWd0S1EvZGRycApkK2ZzcXpEVjdOTWFRMW4xcnlnK1hHSEx1dTZGaTZWZFdXaTU5SUdhaENYamp4UTNuU25kemVEMU9NcTc4eE5iCklOM2tYMXB2WWZycjZWQUV5ajRkRmRTc3VkMEk5ZnZ6bVVDK1hmcVAvN0E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K  
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBc3pYT3JNS2h6Z0ZrTTdnckNUa1AvMnFxMkhEbGJnenBBSVNNV2gvYlB1VWlsYnRaCit4MElyU21PckZJdGllUkMyM1dNUkc1QU5CS0ZYTVE4My80TGR3RDNIRmprQ29lbjlhREliWnYyZzU5RFdNMmEKRGR2TmZ4bkdnNERTMVlFR3R5NG5reU5xeE4vZHNEN1JEejZhNzhDS0RSUkV1eEt4cmVzN1JEUVArc3JTelowZwo4T3Y5eU1lTlY2M1I4NnpsRE83cmdNci9mVVJtb011Vlp2MlBNWnQ2MnpTcVIxWmVlSEk0RE1USTZuaEtkRXBOCjQ2M0tSTWh3NnFZM2JtV1gzY3FHa0xZWFUvQ01xQUd6ejE5NTVhSXlrdDRzZUlrTVk3U0JoMktxQk15eUoyYTYKSmMzMUdENUNFekF4Wkdab2lrRTFqVHVuYnF5UXRObXJCYlc4RlFJREFRQUJBb0lCQURxcEJqbXVpK0F1dkduaApndFRHQk9LS085b1ZPa1JIblkwNTFlYzZQajNjS3ZId0hZZ0EvUElSaEU0THFEUldyenUrd21jejMzZ3NCOU5SCnVNdHBFTCtuWlR1MkxRNzFVSmtxUS9EOCtEZ2xUWm9uMHFGdXJWbEpTcDJJOFhwSmZiVkFPbHdEWDlPSm83c3AKRksxMHhLcHR6OEp3Ty84d0kxRFdpdFBNWnQ2a01IYjB1aFBvZFpQMG5vdkNRVWVUaDFRd2JjWnVZN2FzOUF4TgpLWXdpRGJGNDhMOFczeWFvR3pmZUk3cnJFR284ZEpsMzVXZ3QvNzJJcmhMVHdVR1RzbHNEd1gwSTdUL3o4YlJaClc2dzk0c2hnczUwT2g5dDdjVGo3TUQvTWlpZ0J3NDltc2o1N2h0M2J2TkYyRFl0cmo4Z2N0L0dyY1ZJcENFWjYKczZxY2FSRUNnWUVBNjdJek9MUTRyckpLTFZZM1dUUnhCVmFUbnRKb09yR2g0dmVodnVDWEtEN1BBa2R3aUhqOQpnNkk1UENhSVdObUUvN0xlM2ZQdDJqd2VFeFAxUEhON052eFJWZVREZk0yNmNVOHowUUZ2VFljVERYeW03R1NUCmE5dUJ2R2pEQzVkSDJoRkd1NWliL2FpUXZZOGFWbkltemxyekNkVDBFY1BXYW00am1uRDdyWXNDZ1lFQXdxWHMKeUdRQTNCY3Q5blhVY3M1Ykp5eVpDMlRmYlBPSWF6U3RSdFFxQzBHVHNEQUJjYklBYlo3aDAxd3p6a2RQUGhVOApTZnlZOElSSzh6U29vRGlUdmIxY1puV0FaVDM1ajBwYUZQUk1VQUFBMlRjNDlUVFBKUW15Y2U0MkdqSmdlYi9MClN6TDB0UVZqeUo1bWlkUHNnWTdFc2Q5NkdZbmZKR3VmUlJLK3NOOENnWUJ3WVRjckFrTkVpSjMxbi9Za0FtMGgKTG5hVWM1NWUzZk5pVk5BNlFydlA1S0t2WTRDMGtYdlBGN3BTZzh6ZkVGZnAwMCtRWkk0MFVCWEc0dTA3TlpTNgpVdlExRUM1bGczSXlOS0Z3Tms3cm1FdnRVbElFeEsvRjdaT2VVaFV0b2FRUXhjd0VCbS9hTWxWUkRMcHlIVnVECmFMb1pKZ0I1dC9hMEtHK3hZODJjb1FLQmdCTk83RWNRakhsSW4xbVVaS2VpeXEzL0lZdGN6VUQ4ZzJySEJlMUIKdkkzelNsZ3UydVhSVjNPSVVEUnNNQU5sVlhuK0YwWHJsYXcrSTBVdTB3OVpyV1lqODVlQ1RtTThtNVhZTlVsZwoxblVWR3dCeEZ1aFQvYnhaMHVhMFQ0K1hzYlJDRDBOOVlZTFhid2VHbHZ0VEYySGVyS3BNVmN0VXZ0clpCaXFPCjZuV1hBb0dBSWR6UUJRbUJQSUhKakN6aXVXSlhpQkFrU1lZWWMwSEE4L2luYmxPNmFwRERic0U0N2JoSVZDNmMKWStIaHV4Vks4eHlBOXlySnpHRHBCLzdsaEMxa1h2MVVDS0NOUDZscFdUckpYZ2g1ajhmRXlHNEVaNFV5Tm56UgpRR1ZCMk0xT1BKUGJNclRHaDRoNTllZ1IyVnlCc2hrZG1TQWVXOC9XN0NvRWU1S1JBYUk9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
metadata:
  name: registry-tls
  namespace: default
type: Opaque
